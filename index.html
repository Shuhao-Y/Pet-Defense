<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pet Defense v2.1</title>
<style>
  body { background:#222; color:white; font-family:sans-serif; margin:0; }
  canvas { background:#333; display:block; margin:0 auto; }
  #shopButton { position:fixed; bottom:10px; right:10px; padding:10px; background:#555; border:none; color:white; cursor:pointer; }
  #shopPopup { display:none; position:fixed; bottom:50px; right:10px; width:250px; background:#222; border:2px solid #888; padding:10px; max-height:400px; overflow:auto; }
  .petBox { border:2px solid grey; margin:5px; padding:5px; cursor:pointer; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="500"></canvas>
<button id="shopButton">Shop ðŸ›’</button>
<div id="shopPopup"></div>

<script>
// ========== GAME STATE ==========
const game = {
    inWave:false,
    wave:1,
    coins:100,
    pets: [],
    enemies: [],
    unlockedPets:['cat','dog'],
    petData:{
        cat:{name:'Cat',rarity:'common',health:10,damage:2,speed:2,range:50,ability:'starter'},
        dog:{name:'Dog',rarity:'common',health:15,damage:3,speed:2,range:60,ability:'starter'},
        penguin:{name:'Penguin',rarity:'uncommon',health:12,damage:1,speed:2,range:60,ability:'â„ï¸ Freeze'},
        dragon:{name:'Dragon',rarity:'rare',health:20,damage:5,speed:1.5,range:80,ability:'ðŸ”¥ Burn'},
        tiger:{name:'Tiger',rarity:'rare',health:18,damage:4,speed:2,range:50,ability:'Bleed'},
        fox:{name:'Fox',rarity:'uncommon',health:10,damage:2,speed:3,range:50,ability:'Fast'},
        elephant:{name:'Elephant',rarity:'epic',health:30,damage:0,speed:1,range:50,ability:'ðŸ’« Shield'},
        owl:{name:'Owl',rarity:'rare',health:12,damage:1,speed:2,range:80,ability:'Reveal'},
        axolotl:{name:'Axolotl',rarity:'epic',health:15,damage:2,speed:2,range:50,ability:'â¤ï¸ Heal'},
        eel:{name:'Electric Eel',rarity:'epic',health:14,damage:2,speed:2,range:60,ability:'âš¡ Stun'},
        bombardier:{name:'Bombardier Beetle',rarity:'rare',health:12,damage:3,speed:1.5,range:60,ability:'ðŸ”¥ DOT'},
        lyrebird:{name:'Lyrebird',rarity:'legendary',health:20,damage:4,speed:2,range:50,ability:'Mimic'},
        pig:{name:'Pig',rarity:'uncommon',health:15,damage:1,speed:2,range:50,ability:'ðŸ’° Coins'},
        tardigrade:{name:'Tardigrade',rarity:'legendary',health:50,damage:10,speed:1,range:70,ability:'Ultimate'},
    },
    rarityColors:{common:'grey',uncommon:'green',rare:'red',epic:'purple',legendary:'gold'}
};

// ========== CANVAS ==========
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// ========== SHOP ==========
const shopButton = document.getElementById('shopButton');
const shopPopup = document.getElementById('shopPopup');
shopButton.onclick = ()=>shopPopup.style.display = shopPopup.style.display==='none'?'block':'none';

function updateShop(){
    shopPopup.innerHTML = '';
    let unlockedCount = game.unlockedPets.length;
    let totalCount = Object.keys(game.petData).length;
    let rarityCount = {common:0,uncommon:0,rare:0,epic:0,legendary:0};
    for(let p of Object.keys(game.petData)){
        let r = game.petData[p].rarity; rarityCount[r]++;
    }
    const status = document.createElement('div');
    status.innerHTML = `Unlocked ${unlockedCount}/${totalCount} pets <br>
    (Common:${rarityCount.common}, Uncommon:${rarityCount.uncommon}, Rare:${rarityCount.rare}, Epic:${rarityCount.epic}, Legendary:${rarityCount.legendary})`;
    shopPopup.appendChild(status);

    for(let key of Object.keys(game.petData)){
        if(!game.unlockedPets.includes(key)) continue;
        const pet = game.petData[key];
        const box = document.createElement('div');
        box.className='petBox';
        box.style.borderColor = game.rarityColors[pet.rarity];
        box.innerHTML = `<b>${pet.name}</b> <br>
        â¤ï¸ ${pet.health} ðŸ’¥ ${pet.damage} âš¡ ${pet.speed} ðŸ“ ${pet.range} ðŸŒŸ ${pet.ability}`;
        box.onclick = ()=>{
            if(game.coins>=10){ // simplified price
                game.pets.push({type:key,x:100+Math.random()*500,y:100+Math.random()*300,health:pet.health});
                game.coins-=10;
                alert(`${pet.name} placed!`);
            }else alert("Not enough coins!");
        };
        shopPopup.appendChild(box);
    }
}
updateShop();

// ========== GAME LOOP ==========
function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // draw pets
    for(let p of game.pets){
        ctx.fillStyle = game.rarityColors[game.petData[p.type].rarity];
        ctx.fillRect(p.x,p.y,20,20);
    }
    // draw enemies
    for(let e of game.enemies){
        ctx.fillStyle = e.type==='ghost'?'white':'orange';
        ctx.fillRect(e.x,e.y,20,20);
        e.x += 1; // basic movement
    }
    // remove dead enemies
    game.enemies = game.enemies.filter(e=>e.hp>0);
    requestAnimationFrame(gameLoop);
}
gameLoop();

// ========== PLACEHOLDER: START WAVE ==========
function startWave(){
    game.inWave=true;
    game.enemies.push({type:'normal',x:0,y:200,hp:10});
}
canvas.addEventListener('click',startWave);

</script>
</body>
</html>

